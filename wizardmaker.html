<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wizard Maker â€” Fixed Version</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<link rel="stylesheet" href="./style.css">
</head>
<body>

<div class="card">
  <h1>Wizard Maker â€” Full Toolbar</h1>
  <p>Upload any template or edit the loaded template from index page.</p>

  <div class="topbar">
    <input type="file" id="zipInput" accept=".zip">
    <button id="exportBtn">â¬‡ Export ZIP</button>
  </div>

  <div class="tabs" id="tabs"></div>
  <div id="iframeContainer"></div>
</div>

<!-- Toolbar -->
<div id="editorToolbar" style="display:none;">
  <button id="btnUndo">â®ª Undo</button>
  <button id="btnRedo">â®« Redo</button>
  <button id="btnBold"><b>B</b></button>
  <button id="btnItalic"><i>I</i></button>
  <button id="btnUnderline"><u>U</u></button>
  <select id="fontSelect">
    <option value="Arial">Arial</option>
    <option value="Verdana">Verdana</option>
    <option value="Tahoma">Tahoma</option>
    <option value="Trebuchet MS">Trebuchet MS</option>
    <option value="Times New Roman">Times New Roman</option>
    <option value="Georgia">Georgia</option>
    <option value="Courier New">Courier New</option>
    <option value="Lucida Console">Lucida Console</option>
    <option value="Impact">Impact</option>
    <option value="Comic Sans MS">Comic Sans MS</option>
  </select>
  <input type="number" id="fontSize" min="8" max="72" style="width:60px;">
  <input id="modalText" type="text" placeholder="Text / Placeholder">
  <select id="colorTarget">
    <option value="auto">Auto</option>
    <option value="text">Text Color</option>
    <option value="background">Background</option>
  </select>
  <input type="color" id="modalColor" value="#000000">
  <input type="url" id="imageUrl" placeholder="Image URL">
  <input type="file" id="imageFile" accept="image/*">
  <button id="btnDelete" style="background:#c00;">ðŸ—‘ Delete</button>
  <button id="saveBtn">Save</button>
  <button id="cancelBtn">Cancel</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const zipInput = document.getElementById("zipInput");

  // Load template from index page Base64
  const storedTemplate = localStorage.getItem("wizardTemplate");
  if(storedTemplate){
    try {
      // Convert Base64 string to binary
      const byteString = atob(storedTemplate.split(',')[1]);
      const arrayBuffer = new Uint8Array(byteString.length);
      for(let i=0;i<byteString.length;i++){
        arrayBuffer[i] = byteString.charCodeAt(i);
      }
      const blob = new Blob([arrayBuffer], { type: 'application/zip' });
      const file = new File([blob], "template.zip", { type: "application/zip" });

      // Assign to zipInput
      const dt = new DataTransfer();
      dt.items.add(file);
      zipInput.files = dt.files;

      // Trigger change to load template
      const event = new Event("change");
      zipInput.dispatchEvent(event);

      // Clear localStorage so other loads are independent
      localStorage.removeItem("wizardTemplate");

    } catch(e){
      console.error("Failed to load template:", e);
    }
  }

  // Prevent errors in other scripts before DOM ready
  if(window.initMainJS){
    window.initMainJS();
  }

});
</script>

<script src="main.js"></script>
<script src="theme.js"></script>
<script src="library.js"></script>

</body>
</html>
