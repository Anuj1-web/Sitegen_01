<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wizard Maker — Full Toolbar Edition</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="card">
    <h1>Wizard Maker — Full Toolbar Edition</h1>
    <p>Edit your site templates freely. Each visitor gets a separate copy.</p>

    <div class="topbar">
      <input type="file" id="zipInput" accept=".zip">
      <button id="exportBtn">⬇ Export ZIP</button>
    </div>

    <div class="tabs" id="tabs"></div>
    <div id="iframeContainer"></div>
  </div>

  <!-- Toolbar HTML -->
  <div id="editorToolbar" style="display:none;">
    <!-- Toolbar buttons omitted for brevity; same as your current toolbar -->
  </div>

  <style id="__wizard_theme">
:root {
  --primary-color: #0b79ff;
  --accent-color: #06b6d4;
  --bg-color: #ffffff;
  --text-color: #000000;
}
</style>

<!-- Theme panel omitted for brevity -->
<!-- Library sidebar omitted for brevity -->

<script>
document.addEventListener("DOMContentLoaded", async () => {
  // --- Check if template was sent from index page ---
  const storedTemplate = localStorage.getItem("wizardTemplate");
  if (storedTemplate) {
    try {
      // Convert DataURL to Blob for local use
      const res = await fetch(storedTemplate);
      const blob = await res.blob();

      // Each visitor gets a separate copy: we don't overwrite any other visitor
      const file = new File([blob], `template-${Date.now()}.zip`, { type: "application/zip" });

      // Simulate file input upload
      const dt = new DataTransfer();
      dt.items.add(file);
      const zipInput = document.getElementById("zipInput");
      zipInput.files = dt.files;

      // Trigger your existing logic to load template
      zipInput.dispatchEvent(new Event("change"));

      // Clear so next reload does not auto-load again
      localStorage.removeItem("wizardTemplate");
    } catch (err) {
      console.error("Failed to load template from index page:", err);
    }
  }
});
</script>

<script src="main.js"></script>
<script src="theme.js"></script>
<script src="library.js"></script>

</body>
</html>
