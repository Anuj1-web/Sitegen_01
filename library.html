<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Library Admin</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
  body { background:#fff; color:#000; }
  .card-img { width:100%; height:150px; object-fit:cover; border-radius:0.5rem; }
  .btn { background:black; color:white; padding:0.5rem 1rem; border-radius:0.25rem; }
  .btn:hover{opacity:0.8;}
</style>
</head>
<body class="p-6">

<h1 class="text-3xl font-bold mb-4">Library Admin</h1>

<div class="flex justify-end mb-4">
  <a href="index.html" class="btn">Go to Home</a>
</div>

<!-- Upload Section -->
<div class="mb-6">
  <label class="block mb-2 font-semibold">Upload Template</label>
  <input type="file" id="zipInput" accept=".zip"><br><br>
  <input type="file" id="thumbInput" accept="image/*"><br><br>
  <input type="text" id="templateName" placeholder="Template Name" class="border p-2 mb-2 w-full">
  <button id="uploadBtn" class="btn">Upload Template</button>
</div>

<div id="libraryGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

<script>
async function fetchLibrary() {
  const res = await fetch('library.json');
  return await res.json();
}

async function saveLibrary(lib){
  // Note: This requires server support (POST or manual update)
  console.log("Library updated: ", lib);
  alert("Admin: Update library.json manually or via backend.");
}

async function renderLibrary(){
  const library = await fetchLibrary();
  const grid = document.getElementById('libraryGrid');
  grid.innerHTML = '';
  const categories = {};
  library.forEach((item,index)=>{
    if(!categories[item.type]) categories[item.type]=[];
    categories[item.type].push({...item,index});
  });
  Object.keys(categories).forEach(type=>{
    if(categories[type].length===0) return;
    const title = document.createElement('h3');
    title.textContent = type.charAt(0).toUpperCase()+type.slice(1)+'s';
    title.className="text-xl font-bold mt-6 mb-4 col-span-full";
    grid.appendChild(title);

    categories[type].forEach(obj=>{
      const {index,...item}=obj;
      const card = document.createElement('div');
      card.className="border p-4 rounded shadow flex flex-col items-center";

      const img = document.createElement('img');
      img.src=item.thumbnail;
      img.className="card-img mb-2";
      card.appendChild(img);

      const name = document.createElement('p');
      name.textContent=item.name;
      name.className="font-semibold mb-2 text-center";
      card.appendChild(name);

      grid.appendChild(card);
    });
  });
}

document.getElementById('uploadBtn').addEventListener('click', async ()=>{
  const zipFile = document.getElementById('zipInput').files[0];
  const thumbFile = document.getElementById('thumbInput').files[0];
  const name = document.getElementById('templateName').value || 'Unnamed Template';
  if(!zipFile || !thumbFile){ alert("Select both ZIP and Thumbnail."); return; }

  const zipReader = new FileReader();
  zipReader.onload = async (e)=>{
    const zipBase64 = e.target.result;
    const thumbReader = new FileReader();
    thumbReader.onload = async (ev)=>{
      const thumbBase64 = ev.target.result;
      const lib = await fetchLibrary();
      lib.push({
        name,
        type:"template",
        content:zipBase64,
        thumbnail:thumbBase64
      });
      await saveLibrary(lib);
      renderLibrary();
    };
    thumbReader.readAsDataURL(thumbFile);
  };
  zipReader.readAsDataURL(zipFile);
});

renderLibrary();
</script>
</body>
</html>
